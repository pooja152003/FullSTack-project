<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h2 { margin-top: 40px; }
    form { margin-bottom: 20px; }
    input, select { margin: 5px; padding: 6px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Add Doctor Schedule -->
  <h2>Add Doctor Schedule</h2>
  <!-- Doctor Schedule Form -->
  <form id="doctorScheduleForm">
    <input type="text" id="doctor" placeholder="Doctor Name" required>
    <input type="text" id="department" placeholder="Department" required>
    <input type="text" id="schedule_time" placeholder="Schedule Time" required>
    <button type="submit">Add Schedule</button>
    <span id="schedule-message"></span>
  </form>

  <!-- Doctor Schedule Table -->
  <table id="scheduleTable">
    <thead>
      <tr>
        <th>ID</th><th>Doctor</th><th>Department</th><th>Schedule Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Add User -->
  <h2>Add User</h2>
  <!-- User Form -->
  <form id="userForm">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="text" id="username" placeholder="Username" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <select id="role" required>
      <option value="">Select Role</option>
      <option value="patient">Patient</option>
      <option value="admin">Admin</option>
      <option value="doctor">Doctor</option>
      <option value="staff">Staff</option>
    </select>
    <button type="submit">Add User</button>
    <span id="user-message"></span>
  </form>

  <!-- View Users -->
  <h2>All Users</h2>
  <button onclick="loadUsers()">Refresh Users</button>
  <!-- User Table -->
  <table id="userTable">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Username</th><th>Email</th><th>Role</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // // Doctor Schedule
    // document.getElementById('doctorScheduleForm').addEventListener('submit', async function(e) {
    //   e.preventDefault();
    //   const doctor = document.getElementById('doctor').value;
    //   const department = document.getElementById('department').value;
    //   const schedule_time = document.getElementById('schedule_time').value;
    //   const msg = document.getElementById('schedule-message');
    //   try {
    //     const res = await fetch('http://localhost:3000/api/doctor-schedule', {
    //       method: 'POST',
    //       headers: { 'Content-Type': 'application/json' },
    //       body: JSON.stringify({ doctor, department, schedule_time })
    //     });
    //     const data = await res.json();
    //     if (res.ok) {
    //       msg.textContent = "Added!";
    //       msg.className = "success";
    //       loadSchedules();
    //     } else {
    //       msg.textContent = data.error || "Failed";
    //       msg.className = "error";
    //     }
    //   } catch {
    //     msg.textContent = "Network error";
    //     msg.className = "error";
    //   }
    // });

    // // User
    // document.getElementById('userForm').addEventListener('submit', async function(e) {
    //   e.preventDefault();
    //   const name = document.getElementById('name').value;
    //   const username = document.getElementById('username').value;
    //   const email = document.getElementById('email').value;
    //   const password = document.getElementById('password').value;
    //   const role = document.getElementById('role').value;
    //   const msg = document.getElementById('user-message');
    //   try {
    //     const res = await fetch('http://localhost:3000/api/users/register', {
    //       method: 'POST',
    //       headers: { 'Content-Type': 'application/json' },
    //       body: JSON.stringify({ name, username, email, password, role })
    //     });
    //     const data = await res.json();
    //     if (res.ok) {
    //       msg.textContent = "Added!";
    //       msg.className = "success";
    //       loadUsers();
    //     } else {
    //       msg.textContent = data.error || "Failed";
    //       msg.className = "error";
    //     }
    //   } catch {
    //     msg.textContent = "Network error";
    //     msg.className = "error";
    //   }
    // });

    
    // User Form Submission
document.getElementById('userForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const name = document.getElementById('name').value;
  const username = document.getElementById('username').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value;
  const msg = document.getElementById('user-message');
  try {
    const res = await fetch('http://localhost:3000/api/users/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, username, email, password, role })
    });
    const data = await res.json();
    console.log('User registration response:', data); // Log response
    if (res.ok) {
      msg.textContent = "User added successfully!";
      msg.className = "success";
      loadUsers();
    } else {
      msg.textContent = data.error || "Failed to add user";
      msg.className = "error";
    }
  } catch (err) {
    console.error('Client-side error:', err);
    msg.textContent = "Network error: " + err.message;
    msg.className = "error";
  }
});

// Doctor Schedule Form Submission
document.getElementById('doctorScheduleForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const doctor = document.getElementById('doctor').value;
  const department = document.getElementById('department').value;
  const schedule_time = document.getElementById('schedule_time').value;
  const msg = document.getElementById('schedule-message');
  try {
    const res = await fetch('http://localhost:3000/api/doctor-schedule', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ doctor, department, schedule_time })
    });
    const data = await res.json();
    console.log('Doctor schedule response:', data); // Log response
    if (res.ok) {
      msg.textContent = "Schedule added successfully!";
      msg.className = "success";
      loadSchedules();
    } else {
      msg.textContent = data.error || "Failed to add schedule";
      msg.className = "error";
    }
  } catch (err) {
    console.error('Client-side error:', err);
    msg.textContent = "Network error: " + err.message;
    msg.className = "error";
  }
});

    // Load Doctor Schedules
    async function loadSchedules() {
      const tbody = document.querySelector('#scheduleTable tbody');
      tbody.innerHTML = '';
      try {
        const res = await fetch('http://localhost:3000/api/doctor-schedule');
        const data = await res.json();
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row.id}</td><td>${row.doctor}</td><td>${row.department}</td><td>${row.schedule_time}</td>`;
          tbody.appendChild(tr);
        });
      } catch {}
    }

    // Load Users
    async function loadUsers() {
      const tbody = document.querySelector('#userTable tbody');
      tbody.innerHTML = '';
      try {
        const res = await fetch('http://localhost:3000/api/users');
        const data = await res.json();
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row.id}</td><td>${row.name}</td><td>${row.username}</td><td>${row.email}</td><td>${row.role}</td>`;
          tbody.appendChild(tr);
        });
      } catch {}
    }

    // Initial load
    loadSchedules();
    loadUsers();
  </script>
</body>
</html>